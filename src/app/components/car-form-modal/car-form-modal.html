<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
  <div class="bg-white w-full max-w-2xl border border-gray-200 max-h-[90vh] overflow-y-auto">

    <!-- Header -->
    <div class="flex items-center justify-between p-6 border-b border-gray-200">
      <h2 class="text-2xl font-bold text-gray-900">{{ isEditMode ? 'Modifier la voiture' : 'Ajouter une voiture' }}</h2>
      <button
        (click)="onClose()"
        class="text-gray-400 hover:text-gray-600 focus:outline-none">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <!-- Form -->
    <form [formGroup]="carForm" (ngSubmit)="onSubmit()" class="p-6">

      <div class="space-y-4">

        <!-- Marque -->
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">
            Marque <span class="text-red-600">*</span>
          </label>
          <select
            formControlName="marque_id"
            [class.border-red-600]="isFieldInvalid('marque_id')"
            class="w-full px-4 py-2.5 border-2 border-gray-200 focus:outline-none focus:border-red-600 text-gray-900">
            <option value="">Sélectionnez une marque</option>
            @for (marque of marques$ | async; track marque.id) {
              <option [value]="marque.id">{{ marque.titre }}</option>
            }
          </select>
          @if (isFieldInvalid('marque_id')) {
            <p class="text-red-600 text-sm mt-1">{{ getErrorMessage('marque_id') }}</p>
          }
        </div>

        <!-- Modèle -->
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">
            Modèle <span class="text-red-600">*</span>
          </label>
          <input
            type="text"
            formControlName="modele"
            [class.border-red-600]="isFieldInvalid('modele')"
            placeholder="Ex: 3008"
            class="w-full px-4 py-2.5 border-2 border-gray-200 focus:outline-none focus:border-red-600 text-gray-900">
          @if (isFieldInvalid('modele')) {
            <p class="text-red-600 text-sm mt-1">{{ getErrorMessage('modele') }}</p>
          }
        </div>

        <!-- Prix -->
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">
            Prix (€) <span class="text-red-600">*</span>
          </label>
          <input
            type="number"
            formControlName="prix"
            [class.border-red-600]="isFieldInvalid('prix')"
            placeholder="Ex: 25000"
            class="w-full px-4 py-2.5 border-2 border-gray-200 focus:outline-none focus:border-red-600 text-gray-900">
          @if (isFieldInvalid('prix')) {
            <p class="text-red-600 text-sm mt-1">{{ getErrorMessage('prix') }}</p>
          }
        </div>

        <!-- Carburant -->
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">
            Carburant <span class="text-red-600">*</span>
          </label>
          <select
            formControlName="carburant"
            [class.border-red-600]="isFieldInvalid('carburant')"
            class="w-full px-4 py-2.5 border-2 border-gray-200 focus:outline-none focus:border-red-600 text-gray-900">
            <option value="">Sélectionnez un carburant</option>
            <option value="essence">Essence</option>
            <option value="diesel">Diesel</option>
            <option value="electrique">Électrique</option>
            <option value="hybride">Hybride</option>
          </select>
          @if (isFieldInvalid('carburant')) {
            <p class="text-red-600 text-sm mt-1">{{ getErrorMessage('carburant') }}</p>
          }
        </div>

        <!-- Image URL -->
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">
            URL de l'image <span class="text-red-600">*</span>
          </label>
          <input
            type="text"
            formControlName="image"
            [class.border-red-600]="isFieldInvalid('image')"
            placeholder="https://example.com/car.jpg"
            class="w-full px-4 py-2.5 border-2 border-gray-200 focus:outline-none focus:border-red-600 text-gray-900">
          @if (isFieldInvalid('image')) {
            <p class="text-red-600 text-sm mt-1">{{ getErrorMessage('image') }}</p>
          }
        </div>

        <!-- Date de mise en vente -->
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">
            Date de mise en vente <span class="text-red-600">*</span>
          </label>
          <input
            type="date"
            formControlName="dateDeMiseEnVente"
            [class.border-red-600]="isFieldInvalid('dateDeMiseEnVente')"
            class="w-full px-4 py-2.5 border-2 border-gray-200 focus:outline-none focus:border-red-600 text-gray-900">
          @if (isFieldInvalid('dateDeMiseEnVente')) {
            <p class="text-red-600 text-sm mt-1">{{ getErrorMessage('dateDeMiseEnVente') }}</p>
          }
        </div>

        <!-- Disponibilité -->
        <div class="flex items-center">
          <input
            type="checkbox"
            formControlName="disponibilite"
            id="disponibilite"
            class="w-4 h-4 text-red-600 border-gray-300 focus:ring-red-600">
          <label for="disponibilite" class="ml-2 text-sm font-semibold text-gray-700">
            Disponible à la vente
          </label>
        </div>

      </div>

      <!-- Footer Buttons -->
      <div class="flex gap-4 mt-6 pt-6 border-t border-gray-200">
        <button
          type="button"
          (click)="onClose()"
          class="flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 font-semibold hover:bg-gray-50 focus:outline-none">
          Annuler
        </button>
        <button
          type="submit"
          [disabled]="loading$ | async"
          class="flex-1 px-6 py-3 bg-gradient-to-r from-green-600 to-green-700 text-white font-semibold hover:from-green-700 hover:to-green-800 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed">
          @if (loading$ | async) {
            <span>{{ isEditMode ? 'Modification en cours...' : 'Création en cours...' }}</span>
          } @else {
            <span>{{ isEditMode ? 'Modifier' : 'Créer la voiture' }}</span>
          }
        </button>
      </div>

    </form>

  </div>
</div>
